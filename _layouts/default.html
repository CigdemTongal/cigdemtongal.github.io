<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{{ page.title }}</title>

  <!-- Paged.js -->
  <script src="https://unpkg.com/pagedjs/dist/paged.polyfill.js"></script>

  <!-- Screen-only UI styles: keep separate and mark as screen -->
  <style media="screen">
    :root{
      --red:#ff3e41;
      --orange:#ff8a43;
      --yellow:#ffeb7f;
      --mint:#00c9a7;
      --blue:#007ea7;
      --ink:#0c1b22;
      --canvas: linear-gradient(135deg, rgba(255,235,127,0.85), rgba(0,201,167,0.70));
    }

    html, body { height: 100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--ink);
      background: var(--canvas);
      overflow-y: auto;
    }

    /* Fixed UI chrome (never paginated) */
    .ui{
      position: fixed;
      left: 16px;
      right: 16px;
      top: 14px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 14px;
      border-radius: 16px;
      background: linear-gradient(90deg, var(--blue), var(--mint));
      color: #fff;
      box-shadow: 0 12px 30px rgba(0,0,0,0.22);
      z-index: 9999;
      user-select: none;
    }

    .ui .left{
      display:flex;
      gap:10px;
      align-items:center;
      font-weight:650;
      letter-spacing: .2px;
    }

    .badge{
      background: rgba(255,255,255,0.18);
      border: 1px solid rgba(255,255,255,0.18);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 13px;
      display:flex;
      gap:8px;
      align-items:center;
      white-space: nowrap;
    }

    .ui .right{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .btn{
      border: 0;
      cursor: pointer;
      padding: 9px 12px;
      border-radius: 999px;
      font-size: 13px;
      color: #fff;
      background: rgba(255,255,255,0.18);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
      transition: transform .08s ease, background .15s ease;
    }
    .btn:hover{ background: rgba(255,255,255,0.28); }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      background: linear-gradient(90deg, var(--red), var(--orange));
      box-shadow: 0 10px 20px rgba(255,62,65,0.18);
    }
    .btn.primary:hover{ filter: saturate(1.05); }

    /* Preview area (pages get appended here) */
    #preview{
      padding-top: 92px; /* space for chrome */
      padding-bottom: 56px;
      min-height: 100%;
    }

    /* Paper pages created by Paged.js */
    .pagedjs_page{
      background: #fff;
      margin: 22px auto;
      border-radius: 10px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.28);
      overflow: hidden;
    }

    /* Nice ‚Äúpage edge‚Äù hint */
    .pagedjs_page::before{
      content:"";
      display:block;
      height: 10px;
      background: linear-gradient(90deg, var(--yellow), rgba(255,235,127,0), rgba(0,201,167,0), var(--mint));
      opacity: .55;
    }

    /* Modal */
    .modal{
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      background: rgba(12,27,34,0.55);
      padding: 18px;
    }
    .modal .card{
      width: min(520px, 100%);
      border-radius: 18px;
      background: #fff;
      box-shadow: 0 30px 70px rgba(0,0,0,0.35);
      border-top: 8px solid var(--orange);
      padding: 18px 18px 14px;
    }
    .modal h3{
      margin: 0 0 6px;
      color: var(--blue);
      font-size: 18px;
    }
    .modal p{
      margin: 8px 0;
      line-height: 1.55;
      font-size: 14px;
    }
    .modal code{
      background: rgba(0,126,167,0.08);
      padding: 2px 6px;
      border-radius: 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
    }
    .modal .row{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .modal .close{
      background: linear-gradient(90deg, var(--mint), var(--blue));
    }

    /* Hide the source content container after pagination */
    #source{
      display:none;
    }
  </style>

  <!-- Print rules (Paged.js uses @page) -->
  <style>
    @page{
      size: A4;
      margin: 2.5cm;
    }

    /* Print: remove any shadows if they survive */
    @media print{
      .pagedjs_page{ box-shadow: none !important; border-radius: 0 !important; margin: 0 !important; }
    }
  </style>
</head>

<body>

  <!-- SCREEN-ONLY UI (not paginated) -->
  <div class="ui" aria-hidden="true">
    <div class="left">
      <div class="badge">üìÑ Paged Preview</div>
      <div class="badge" id="counter">Pages: ‚Ä¶</div>
    </div>
    <div class="right">
      <button class="btn" type="button" onclick="openInfo()">‚ÑπÔ∏è Info</button>
      <button class="btn primary" type="button" onclick="window.print()">Print</button>
    </div>
  </div>

  <!-- Paged.js will render pages into THIS container -->
  <div id="preview"></div>

  <!-- Source content: Paged.js paginates THIS, then we keep it hidden -->
  <div id="source">
    {{ content }}
  </div>

  <!-- Info modal (screen only) -->
  <div class="modal" id="infoModal" role="dialog" aria-modal="true" aria-label="Print help">
    <div class="card">
      <h3>Perfect PDFs in Chrome ‚ú®</h3>
      <p>Use <strong>Google Chrome</strong> (it‚Äôs the most predictable for paged media).</p>
      <p>
        Print settings:
        <br>‚Ä¢ Paper size: <strong>A4</strong>
        <br>‚Ä¢ Scale: <strong>100%</strong>
        <br>‚Ä¢ Margins: <strong>None</strong>
        <br>‚Ä¢ Background graphics: <strong>On</strong>
        <br>‚Ä¢ Headers &amp; footers: <strong>Off</strong>
      </p>
      <p><em>Paged.js already paginated the document ‚Äî don‚Äôt let the browser ‚Äúhelp.‚Äù üòâ</em></p>
      <div class="row">
        <button class="btn close" type="button" onclick="closeInfo()">Got it</button>
      </div>
    </div>
  </div>

  <script>
    function openInfo(){ document.getElementById("infoModal").style.display = "flex"; }
    function closeInfo(){ document.getElementById("infoModal").style.display = "none"; }

    // Proper method: paginate ONLY #source into #preview using the Previewer API.
    (function initPagedPreview(){
      const src = document.getElementById("source");
      const out = document.getElementById("preview");

      // If Paged isn't ready for any reason, fail gracefully.
      if (!window.Paged || !Paged.Previewer) {
        out.innerHTML = "<div style='padding:120px 20px;max-width:680px;margin:0 auto;color:#06222c;'><strong>Paged.js not available.</strong></div>";
        return;
      }

      const previewer = new Paged.Previewer();

      // preview(content, stylesheetsArray, renderTo)
      // stylesheetsArray can be empty because we're already in the document.
      previewer.preview(src, [], out).then((flow) => {
        // flow.total is sometimes available; safest is to count generated pages:
        const pages = out.querySelectorAll(".pagedjs_page").length;
        const el = document.getElementById("counter");
        if (el) el.textContent = "Pages: " + pages;
      });
    })();
  </script>

</body>
</html>

